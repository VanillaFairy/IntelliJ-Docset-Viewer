<html><!-- Mirrored from www.chaijs.com/guide/helpers/ by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 15 Apr 2025 08:02:15 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Building a Helper</title>
    <meta name="description" content="Building a Helper">

    <link rel="icon" type="image/x-icon" href="../../img/favicon.ico">
    <link rel="canonical" href="index.html">

    <script type="text/javascript" async="" src="http://www.google-analytics.com/ga.js"></script><script src="../../../ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="../../js/jquery-mousewheel.js"></script>
    <script src="../../js/antiscroll.js"></script>
    <script src="../../js/main.js"></script>
    <script src="../../chai.js"></script>

    <link rel="stylesheet" ,="" href="../../css/antiscroll.css" type="text/css" media="all">
    <link rel="stylesheet" ,="" href="../../css/main.css" type="text/css" media="all">
    <script type="text/javascript">
        var mpq = [];
        mpq.push(["init", "d5e84615dbd02dbc359b0f76d0ed7cf5"]);
        (function(){var b,a,e,d,c;b=document.createElement("script");b.type="text/javascript";
        b.async=true;b.src=(document.location.protocol==="https:"?"https:":"http:")+
        ""exit/site_media/js/api/mixpanel.js";a=document.getElementsByTagName("script")[0];
        a.parentNode.insertBefore(b,a);e=function(f){return function(){mpq.push(
        [f].concat(Array.prototype.slice.call(arguments,0)))}};d=["init","track","track_links",
        "track_forms","register","register_once","identify","name_tag","set_config"];for(c=0;c<
        d.length;c++){mpq[d[c]]=e(d[c])}})();
    </script>
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-26183904-6']);
        _gaq.push(['_trackPageview']);
        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>
</head>


  <body class="guide">

    <nav id="primary">
    <div class="nav-wrap">
        <div class="logo">
            <h1><a href="https://www.chaijs.com/">Chai Assertion Library</a></h1>
        </div>
        <div class="navlist">
            <ul>
                <li><a href="../index.html">Guide</a></li>
                <li><a href="../../api/index.html">API</a></li>
                <li><a href="https://www.chaijs.com/plugins">Plugins</a></li>
            </ul>
        </div>
    </div>
</nav>


    

    <div class="content">
      <section id="content">
        <nav id="guide" class="sidebar sticky">

    
    
      
      
      
      
      <div id="getting-started-guide" class="item primary">
          
            <span class="star"></span>
          
          <a href="../index.html" class="title">Getting Started Guide</a>
      </div>
      
      
        <div class="line"></div>
      
    
      
      
      
      
      <div id="installation" class="item primary">
          
            <span class="expand">+</span>
            <span class="collapse">-</span>
          
          <a href="../installation/index.html" class="title">Installation</a>
      </div>
      
      <div id="installation" class="subitems">
          
          
          <a href="../installation/index.html#nodejs" class="item secondary group-installation">Node.js</a>
          
          
          <a href="../installation/index.html#browser" class="item secondary group-installation">Browser</a>
          
          
          <a href="../installation/index.html#other-platforms" class="item secondary group-installation">Other Platforms</a>
          
      </div>
      
      
    
      
      
      
      
      <div id="assertion-styles" class="item primary">
          
            <span class="expand">+</span>
            <span class="collapse">-</span>
          
          <a href="../styles/index.html" class="title">Assertion Styles</a>
      </div>
      
      <div id="assertion-styles" class="subitems">
          
          
          <a href="../styles/index.html#assert" class="item secondary group-assertion-styles">Assert</a>
          
          
          <a href="../styles/index.html#expect" class="item secondary group-assertion-styles">Expect</a>
          
          
          <a href="../styles/index.html#should" class="item secondary group-assertion-styles">Should</a>
          
          
          <a href="../styles/index.html#differences" class="item secondary group-assertion-styles">Differences</a>
          
          
          <a href="../styles/index.html#should-extras" class="item secondary group-assertion-styles">Should Extras</a>
          
          
          <a href="../styles/index.html#configuration" class="item secondary group-assertion-styles">Configuration</a>
          
      </div>
      
      
    
      
      
      
      
      <div id="using-chai-with-esm-and-plugins" class="item primary">
          
            <span class="expand">+</span>
            <span class="collapse">-</span>
          
          <a href="../using-chai-with-esm-and-plugins/index.html" class="title">Using Chai with ESM and Plugins</a>
      </div>
      
      <div id="using-chai-with-esm-and-plugins" class="subitems">
          
          
          <a href="../using-chai-with-esm-and-plugins/index.html#importing-chai" class="item secondary group-using-chai-with-esm-and-plugins">Importing Chai</a>
          
          
          <a href="../using-chai-with-esm-and-plugins/index.html#using-plugins" class="item secondary group-using-chai-with-esm-and-plugins">Using Plugins</a>
          
          
          <a href="../using-chai-with-esm-and-plugins/index.html#exposing-globals-in-plugins" class="item secondary group-using-chai-with-esm-and-plugins">Exposing Globals in Plugins</a>
          
      </div>
      
      
    
      
      
      
      
      <div id="core-plugin-concepts" class="item primary">
          
            <span class="expand">+</span>
            <span class="collapse">-</span>
          
          <a href="../plugins/index.html" class="title">Core Plugin Concepts</a>
      </div>
      
      <div id="core-plugin-concepts" class="subitems">
          
          
          <a href="../plugins/index.html#accessing-utilities" class="item secondary group-core-plugin-concepts">Accessing Utilities</a>
          
          
          <a href="../plugins/index.html#using-flags" class="item secondary group-core-plugin-concepts">Using Flags</a>
          
          
          <a href="../plugins/index.html#composing-an-assertion" class="item secondary group-core-plugin-concepts">Composing an Assertion</a>
          
      </div>
      
      
    
      
      
      
      
      <div id="building-a-helper" class="item primary active expanded">
          
            <span class="expand">+</span>
            <span class="collapse">-</span>
          
          <a href="index.html" class="title">Building a Helper</a>
      </div>
      
      <div id="building-a-helper" class="subitems">
          
          
          <a href="index.html#adding-language-chains" class="item secondary group-building-a-helper expanded">Adding Language Chains</a>
          
          
          <a href="index.html#adding-properties" class="item secondary group-building-a-helper expanded">Adding Properties</a>
          
          
          <a href="index.html#adding-methods" class="item secondary group-building-a-helper expanded">Adding Methods</a>
          
          
          <a href="index.html#methods-as-properties" class="item secondary group-building-a-helper expanded">Methods as Properties</a>
          
          
          <a href="index.html#overwriting-language-chains" class="item secondary group-building-a-helper expanded">Overwriting Language Chains</a>
          
          
          <a href="index.html#overwriting-properties" class="item secondary group-building-a-helper expanded">Overwriting Properties</a>
          
          
          <a href="index.html#overwriting-methods" class="item secondary group-building-a-helper expanded">Overwriting Methods</a>
          
      </div>
      
      
    
      
      
      
      
      <div id="resources" class="item primary">
          
            <span class="expand">+</span>
            <span class="collapse">-</span>
          
          <a href="../resources/index.html" class="title">Resources</a>
      </div>
      
      <div id="resources" class="subitems">
          
          
          <a href="../resources/index.html#getting-help" class="item secondary group-resources">Getting Help</a>
          
          
          <a href="../resources/index.html#contributing" class="item secondary group-resources">Contributing</a>
          
      </div>
      
      
    
</nav>
<div class="documentation">
    <div class="wrap">
        <div class="rendered">
            <h1 id="building-a-helper">Building a Helper</h1>

<blockquote>
  <p>This tutorial assumes that you are familiar with the plugin <a href="../plugins/index.html">core concepts</a>.
If you have not yet read that article, it is recommended that you do so before continuing.</p>
</blockquote>

<p>Providing chainable helper assertions is the most common use of the plugin utilities
that Chai exposes. Before we get into the basics, we are going to need a topic
for which we will extend Chai’s assertions to comprehend. For this, we will be
using a very minimal data model object.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * # Model
 *
 * A constructor for a simple data model
 * object. Has a `type` and contains arbitrary
 * attributes.
 *
 * @param {String} type
 */</span>

<span class="kd">function</span> <span class="nx">Model</span> <span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_type</span> <span class="o">=</span> <span class="nx">type</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_attrs</span> <span class="o">=</span> <span class="p">{};</span>
<span class="p">}</span>

<span class="cm">/**
 * .set (key, value)
 *
 * Set an attribute to be stored in this model.
 *
 * @param {String} key
 * @param {Mixted} value
 */</span>

<span class="nx">Model</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="kd">set</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_attrs</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**
 * .get (key)
 *
 * Get an attribute that is stored in this model.
 *
 * @param {String} key
 */</span>

<span class="nx">Model</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="kd">get</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_attrs</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
<span class="p">};</span>
</code></pre></div></div>

<p>Practically speaking, this could be any data model object returned from an
ORM database in node or constructed from your MVC framework of choice in
the browser.</p>

<p>Hopefully our <code class="language-js highlighter-rouge"><span class="nx">Model</span></code> class is self explanatory, but as an example,
here we construct a person object.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">arthur</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Model</span><span class="p">(</span><span class="dl">'</span><span class="s1">person</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">arthur</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">name</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Arthur Dent</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">arthur</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">occupation</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">traveller</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">arthur</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">name</span><span class="dl">'</span><span class="p">));</span> <span class="c1">// Arthur Dent</span>
</code></pre></div></div>

<p>Now that we have our subject, we can move on to the basics of plugins.</p>

<a class="dashAnchor" name="//apple_ref/Section/Adding%20Language%20Chains"></a><h2 id="adding-language-chains">Adding Language Chains</h2>

<p>Now we are getting to the fun part! Adding properties and methods
are what Chai’s plugin API is really for.</p>

<a class="dashAnchor" name="//apple_ref/Section/Adding%20Properties"></a><h3 id="adding-properties">Adding Properties</h3>

<p>In essence, defining a property can be done using <code class="language-js highlighter-rouge"><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span></code>,
but we encourage you to use Chai’s utility helpers to ensure a standard
implementation throughout.</p>

<p>For this example, we want the following test case to pass:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">arthur</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Model</span><span class="p">(</span><span class="dl">'</span><span class="s1">person</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">arthur</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">be</span><span class="p">.</span><span class="nx">a</span><span class="p">.</span><span class="nx">model</span><span class="p">;</span>
</code></pre></div></div>

<p>For this, we will use the <code class="language-js highlighter-rouge"><span class="nx">addProperty</span></code> utility.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">utils</span><span class="p">.</span><span class="nx">addProperty</span><span class="p">(</span><span class="nx">Assertion</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="dl">'</span><span class="s1">model</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">assert</span><span class="p">(</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_obj</span> <span class="k">instanceof</span> <span class="nx">Model</span>
    <span class="p">,</span> <span class="dl">'</span><span class="s1">expected #{this} to be a Model</span><span class="dl">'</span>
    <span class="p">,</span> <span class="dl">'</span><span class="s1">expected #{this} to not be a Model</span><span class="dl">'</span>
  <span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<p><a href="../../api/plugins/index.html#method_addproperty" class="clean-button">View addProperty API</a></p>

<p>Simple and concise. Chai can take it from here. It is also worth mentioning that
because this extension pattern is used so often, Chai makes it just a bit easier.
The following can be used in place of the first line above:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Assertion</span><span class="p">.</span><span class="nx">addProperty</span><span class="p">(</span><span class="dl">'</span><span class="s1">model</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="c1">// ...</span>
</code></pre></div></div>

<p>All chain extension utilities are provided both as part of the <code class="language-js highlighter-rouge"><span class="nx">utils</span></code> object
and directly on the Assertion constructor. For the rest of this document, however,
we will be calling the methods directly from <code class="language-js highlighter-rouge"><span class="nx">Assertion</span></code>.</p>

<a class="dashAnchor" name="//apple_ref/Section/Adding%20Methods"></a><h3 id="adding-methods">Adding Methods</h3>

<blockquote>
  <p>Note: Multiple plugins defining the same method name using <code class="language-js highlighter-rouge"><span class="nx">addMethod</span></code> will conflict, with the last-registered plugin winning. The plugin API is pending a major overhaul in future versions of Chai that will, among other things, deal with this conflict. In the mean time, please prefer using <code class="language-js highlighter-rouge"><span class="nx">overwriteMethod</span></code>.</p>
</blockquote>

<p>Though a property is an elegant solution, it is likely not specific enough for
the helper we are constructing. As our models have types, it would be beneficial
to assert that our model is of a specific type. For this, we need a method.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// goal</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">arthur</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">be</span><span class="p">.</span><span class="nx">a</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="dl">'</span><span class="s1">person</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// language chain method</span>
<span class="nx">Assertion</span><span class="p">.</span><span class="nx">addMethod</span><span class="p">(</span><span class="dl">'</span><span class="s1">model</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">obj</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_obj</span><span class="p">;</span>

  <span class="c1">// first, our instanceof check, shortcut</span>
  <span class="k">new</span> <span class="nx">Assertion</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_obj</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">be</span><span class="p">.</span><span class="k">instanceof</span><span class="p">(</span><span class="nx">Model</span><span class="p">);</span>

  <span class="c1">// second, our type check</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">assert</span><span class="p">(</span>
      <span class="nx">obj</span><span class="p">.</span><span class="nx">_type</span> <span class="o">===</span> <span class="nx">type</span>
    <span class="p">,</span> <span class="dl">"</span><span class="s2">expected #{this} to be of type #{exp} but got #{act}</span><span class="dl">"</span>
    <span class="p">,</span> <span class="dl">"</span><span class="s2">expected #{this} to not be of type #{act}</span><span class="dl">"</span>
    <span class="p">,</span> <span class="nx">type</span>        <span class="c1">// expected</span>
    <span class="p">,</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">_type</span>   <span class="c1">// actual</span>
  <span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<p><a href="../../api/plugins/index.html#method_addmethod" class="clean-button">View addMethod API</a></p>

<p>All calls to <code class="language-js highlighter-rouge"><span class="nx">assert</span></code> are synchronous, so if the first one fails the <code class="language-js highlighter-rouge"><span class="nx">AssertionError</span></code>
is thrown and the second one will not be reached. It is up to the test runner to interpret
the message and handle display of any failed assertions.</p>

<a class="dashAnchor" name="//apple_ref/Section/Methods%20as%20Properties"></a><h3 id="methods-as-properties">Methods as Properties</h3>

<p>Chai includes a unique utility that allows you to construct a language chain that can function
as either a property or a method. We call these “chainable methods”. Despite the fact that we
demonstrated the “is model of model” as both a property and a method, these assertions are NOT
a good use case for chainable methods.</p>

<h5 id="when-to-use">When to Use</h5>

<p>To understand when to best use chainable methods we will examine a chainable method from Chai’s
core.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="p">];</span>
<span class="kd">const</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span> <span class="na">a</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">b</span><span class="p">:</span> <span class="mi">2</span> <span class="p">};</span>

<span class="nx">expect</span><span class="p">(</span><span class="nx">arr</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">contain</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">obj</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">contain</span><span class="p">.</span><span class="nx">key</span><span class="p">(</span><span class="dl">'</span><span class="s1">a</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p>For this to work, two separate functions are needed. One that will be invoked when the
chain is used as either a property or a method, and one that will be invoked when only used
as a method.</p>

<p>In these examples, and with all of the other chainable methods in core, the only function
of <code class="language-js highlighter-rouge"><span class="nx">contain</span></code> as a property is to set a <code class="language-js highlighter-rouge"><span class="nx">contains</span></code> flag to true. This indicates to <code class="language-js highlighter-rouge"><span class="nx">keys</span></code> to
behave differently. In this case, when <code class="language-js highlighter-rouge"><span class="nx">key</span></code> is used in conjunction with <code class="language-js highlighter-rouge"><span class="nx">contain</span></code>, it will check
for the inclusion of a key, instead of checking the exact match to all keys.</p>

<h5 id="when-not-to-use">When NOT to Use</h5>

<p>Let’s say we set up a chainable method for <code class="language-js highlighter-rouge"><span class="nx">model</span></code> to behave as we indicated above: do an <code class="language-js highlighter-rouge"><span class="k">instanceof</span></code>
check if used as a property, and a <code class="language-js highlighter-rouge"><span class="nx">_type</span></code> check if used as a method. The following conflict would occur…</p>

<p>The following would work…</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">arthur</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">be</span><span class="p">.</span><span class="nx">a</span><span class="p">.</span><span class="nx">model</span><span class="p">;</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">arthur</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">be</span><span class="p">.</span><span class="nx">a</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="dl">'</span><span class="s1">person</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">arr</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">not</span><span class="p">.</span><span class="nx">be</span><span class="p">.</span><span class="nx">a</span><span class="p">.</span><span class="nx">model</span><span class="p">;</span>
</code></pre></div></div>

<p>But the following would not…</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">arthur</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">not</span><span class="p">.</span><span class="nx">be</span><span class="p">.</span><span class="nx">a</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="dl">'</span><span class="s1">person</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p>Remember, since the function used as the property assertion is invoked when also used as a method,
and negation impacts ALL assertions after it is set, we would receive an error message resembling
<code class="language-js highlighter-rouge"><span class="nx">expected</span> <span class="p">[</span><span class="nx">object</span> <span class="nx">Model</span><span class="p">]</span> <span class="nx">not</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">instance</span> <span class="k">of</span> <span class="p">[</span><span class="nx">object</span> <span class="nx">Model</span><span class="p">]</span></code>. As such, please obey this general
guideline when constructing chainable methods.</p>

<blockquote>
  <p>When constructing chainable methods, the property function should only serve to set a flag for later modifying the behavior of an existing assertion.</p>
</blockquote>

<h5 id="an-appropriate-example">An Appropriate Example</h5>

<p>For use with our model example, we are going to construct an example that allows us to test Arthur’s
age exactly, or chain into Chai’s numerical comparators, such as <code class="language-js highlighter-rouge"><span class="nx">above</span></code>, <code class="language-js highlighter-rouge"><span class="nx">below</span></code>, and <code class="language-js highlighter-rouge"><span class="nx">within</span></code>. You will
need to learn how to overwrite methods without destroying core functionality, but we get to that a bit later.</p>

<p>Our goal will allow for all of the following to pass.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">arthur</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">have</span><span class="p">.</span><span class="nx">age</span><span class="p">(</span><span class="mi">27</span><span class="p">);</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">arthur</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">have</span><span class="p">.</span><span class="nx">age</span><span class="p">.</span><span class="nx">above</span><span class="p">(</span><span class="mi">17</span><span class="p">);</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">arthur</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">not</span><span class="p">.</span><span class="nx">have</span><span class="p">.</span><span class="nx">age</span><span class="p">.</span><span class="nx">below</span><span class="p">(</span><span class="mi">18</span><span class="p">);</span>
</code></pre></div></div>

<p>Let’s start first by composing the two functions needed for a chainable method. First up is the function
to use when invoking the <code class="language-js highlighter-rouge"><span class="nx">age</span></code> method.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">assertModelAge</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// make sure we are working with a model</span>
  <span class="k">new</span> <span class="nx">Assertion</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_obj</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">be</span><span class="p">.</span><span class="k">instanceof</span><span class="p">(</span><span class="nx">Model</span><span class="p">);</span>

  <span class="c1">// make sure we have an age and its a number</span>
  <span class="kd">const</span> <span class="nx">age</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_obj</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">age</span><span class="dl">'</span><span class="p">);</span>
  <span class="k">new</span> <span class="nx">Assertion</span><span class="p">(</span><span class="nx">age</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">be</span><span class="p">.</span><span class="nx">a</span><span class="p">(</span><span class="dl">'</span><span class="s1">number</span><span class="dl">'</span><span class="p">);</span>

  <span class="c1">// do our comparison</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">assert</span><span class="p">(</span>
      <span class="nx">age</span> <span class="o">===</span> <span class="nx">n</span>
    <span class="p">,</span> <span class="dl">"</span><span class="s2">expected #{this} to have age #{exp} but got #{act}</span><span class="dl">"</span>
    <span class="p">,</span> <span class="dl">"</span><span class="s2">expected #{this} to not have age #{act}</span><span class="dl">"</span>
    <span class="p">,</span> <span class="nx">n</span>
    <span class="p">,</span> <span class="nx">age</span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>By now, that should be self-explanatory. Now for our property function.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">chainModelAge</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">utils</span><span class="p">.</span><span class="nx">flag</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="dl">'</span><span class="s1">model.age</span><span class="dl">'</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We will later teach our numerical comparators to look for that flag and change its behavior. Since we don’t want to
break the core methods, we will need to safely override that method, but we’ll get to that in a minute. Let’s
finish up here first…</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Assertion</span><span class="p">.</span><span class="nx">addChainableMethod</span><span class="p">(</span><span class="dl">'</span><span class="s1">age</span><span class="dl">'</span><span class="p">,</span> <span class="nx">assertModelAge</span><span class="p">,</span> <span class="nx">chainModelAge</span><span class="p">);</span>
</code></pre></div></div>

<p><a href="../../api/plugins/index.html#method_addchainablemethod" class="clean-button">View addChainableMethod API</a></p>

<p>Done. Now we can assert Arthur’s exact age. We will pick up again with this example when learning how to overwrite methods.</p>

<a class="dashAnchor" name="//apple_ref/Section/Overwriting%20Language%20Chains"></a><h2 id="overwriting-language-chains">Overwriting Language Chains</h2>

<p>Now that we can successfully add assertions to the language chain,
we should work on being able to safely overwrite existing assertions,
such as those from Chai’s core or other plugins.</p>

<p>Chai provides a number of utilities that allow you to overwrite
existing behavior of an already existing assertion, but revert to
the already defined assertion behavior if the subject of the assertion
does not meet your criteria.</p>

<p>Let’s start with a simple example of overwriting a property.</p>

<a class="dashAnchor" name="//apple_ref/Section/Overwriting%20Properties"></a><h3 id="overwriting-properties">Overwriting Properties</h3>

<p>For this example, we are going to overwrite the <code class="language-js highlighter-rouge"><span class="nx">ok</span></code> property provided
by Chai’s core. The default behavior is that <code class="language-js highlighter-rouge"><span class="nx">ok</span></code> will pass if an object
is truthy. We want to change that behavior so then when <code class="language-js highlighter-rouge"><span class="nx">ok</span></code> is used
with an instance of a model, it validates that the model is well formed.
In our example, we will consider a model <code class="language-js highlighter-rouge"><span class="nx">ok</span></code> if it has an <code class="language-js highlighter-rouge"><span class="nx">id</span></code> attribute.</p>

<p>Let’s start out with the basic overwrite utility and a basic assertion.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">chai</span><span class="p">.</span><span class="nx">overwriteProperty</span><span class="p">(</span><span class="dl">'</span><span class="s1">ok</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">_super</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kd">function</span> <span class="nx">checkModel</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">obj</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_obj</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">&amp;&amp;</span> <span class="nx">obj</span> <span class="k">instanceof</span> <span class="nx">Model</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">new</span> <span class="nx">Assertion</span><span class="p">(</span><span class="nx">obj</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">have</span><span class="p">.</span><span class="nx">deep</span><span class="p">.</span><span class="nx">property</span><span class="p">(</span><span class="dl">'</span><span class="s1">_attrs.id</span><span class="dl">'</span><span class="p">).</span><span class="nx">a</span><span class="p">(</span><span class="dl">'</span><span class="s1">number</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">_super</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">});</span>
</code></pre></div></div>

<p><a href="../../api/plugins/index.html#method_overwriteproperty" class="clean-button">View overwriteProperty API</a></p>

<h5 id="overwrite-structure">Overwrite Structure</h5>

<p>As you can see, the main difference in overwriting is that the first function
passes just one argument of <code class="language-js highlighter-rouge"><span class="nx">_super</span></code>. This is the function that originally
existed, and you should be sure to call that if your criteria doesn’t match.
Secondly, you will notice that we immediately return a new function that
will serve as the actual assertion.</p>

<p>With this in place, we can write positive assertions.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">arthur</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Model</span><span class="p">(</span><span class="dl">'</span><span class="s1">person</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">arthur</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">id</span><span class="dl">'</span><span class="p">,</span> <span class="mi">42</span><span class="p">);</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">arthur</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">be</span><span class="p">.</span><span class="nx">ok</span><span class="p">;</span>
<span class="nx">expect</span><span class="p">(</span><span class="kc">true</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">be</span><span class="p">.</span><span class="nx">ok</span><span class="p">;</span>
</code></pre></div></div>

<p>The above expectations will pass. When working with a model it will
run our custom assertion, and when working with non-models it will
revert to the original behavior. We will, however, run into a bit of
trouble if we try to negate an <code class="language-js highlighter-rouge"><span class="nx">ok</span></code> assertion on a model.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">arthur</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Model</span><span class="p">(</span><span class="dl">'</span><span class="s1">person</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">arthur</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">id</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">dont panic</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">arthur</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">not</span><span class="p">.</span><span class="nx">be</span><span class="p">.</span><span class="nx">ok</span><span class="p">;</span>
</code></pre></div></div>

<p>We would expect this expectation to pass as well, as our statement is
negated and the id is not a number. Unfortunately, the negation flag
was not passed to our number assertion, so it still expects the value
to be a number.</p>

<h5 id="transferring-flags">Transferring Flags</h5>

<p>For this we will expand on this assertion by transferring all of the
flags from the original assertion to our new assertion. The final
property overwrite would look like this.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">chai</span><span class="p">.</span><span class="nx">overwriteProperty</span><span class="p">(</span><span class="dl">'</span><span class="s1">ok</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">_super</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kd">function</span> <span class="nx">checkModel</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">obj</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_obj</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">&amp;&amp;</span> <span class="nx">obj</span> <span class="k">instanceof</span> <span class="nx">Model</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">new</span> <span class="nx">Assertion</span><span class="p">(</span><span class="nx">obj</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">have</span><span class="p">.</span><span class="nx">deep</span><span class="p">.</span><span class="nx">property</span><span class="p">(</span><span class="dl">'</span><span class="s1">_attrs.id</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// we always want this</span>
      <span class="kd">const</span> <span class="nx">assertId</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Assertion</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">_attrs</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
      <span class="nx">utils</span><span class="p">.</span><span class="nx">transferFlags</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">assertId</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span> <span class="c1">// false means don't transfer `object` flag</span>
      <span class="nx">assertId</span><span class="p">.</span><span class="nx">is</span><span class="p">.</span><span class="nx">a</span><span class="p">(</span><span class="dl">'</span><span class="s1">number</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">_super</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Now, the negation flag is included in your new assertion and we can successfully
handle both positive and negative assertions on the type of id. We left the property
assertion as it was as we always want it to fail if the id is not present.</p>

<h5 id="enhancing-error-messages">Enhancing Error Messages</h5>

<p>Though, we have one more small modification to make. Should our assertion fail
for the wrong type of id attribute, we would get an error message that states
<code class="language-js highlighter-rouge"><span class="nx">expected</span> <span class="dl">'</span><span class="s1">dont panic</span><span class="dl">'</span> <span class="nx">to</span> <span class="p">[</span><span class="nx">not</span><span class="p">]</span> <span class="nx">be</span> <span class="nx">a</span> <span class="nx">number</span></code>. Not entirely useful when running a large
test suite, so we will provide it with a bit more information.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">assertId</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Assertion</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">_attrs</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="dl">'</span><span class="s1">model assert ok id type</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p>This will change our error message to be a more informative <code class="language-js highlighter-rouge"><span class="nx">model</span> <span class="nx">assert</span> <span class="nx">ok</span> <span class="nx">id</span> <span class="nx">type</span><span class="p">:</span>
<span class="nx">expected</span> <span class="dl">'</span><span class="s1">dont panic</span><span class="dl">'</span> <span class="nx">to</span> <span class="p">[</span><span class="nx">not</span><span class="p">]</span> <span class="nx">be</span> <span class="nx">a</span> <span class="nx">number</span></code>. Much more informative!</p>

<a class="dashAnchor" name="//apple_ref/Section/Overwriting%20Methods"></a><h3 id="overwriting-methods">Overwriting Methods</h3>

<p>Overwriting methods follow the same structure of overwriting properties.
For this example we will be returning to our example of asserting Arthur’s
age to be above a minimum threshold.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">arthur</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Model</span><span class="p">(</span><span class="dl">'</span><span class="s1">person</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">arthur</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">age</span><span class="dl">'</span><span class="p">,</span> <span class="mi">27</span><span class="p">);</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">arthur</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">have</span><span class="p">.</span><span class="nx">age</span><span class="p">.</span><span class="nx">above</span><span class="p">(</span><span class="mi">17</span><span class="p">);</span>
</code></pre></div></div>

<p>We already have our <code class="language-js highlighter-rouge"><span class="nx">age</span></code> chain in place to flag the assertion with <code class="language-js highlighter-rouge"><span class="nx">model</span><span class="p">.</span><span class="nx">age</span></code>
so all we have to do is check if that exists.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Assertion</span><span class="p">.</span><span class="nx">overwriteMethod</span><span class="p">(</span><span class="dl">'</span><span class="s1">above</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">_super</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kd">function</span> <span class="nx">assertAge</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">utils</span><span class="p">.</span><span class="nx">flag</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="dl">'</span><span class="s1">model.age</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">obj</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_obj</span><span class="p">;</span>

      <span class="c1">// first we assert we are actually working with a model</span>
      <span class="k">new</span> <span class="nx">Assertion</span><span class="p">(</span><span class="nx">obj</span><span class="p">).</span><span class="k">instanceof</span><span class="p">(</span><span class="nx">Model</span><span class="p">);</span>

      <span class="c1">// next, make sure we have an age</span>
      <span class="k">new</span> <span class="nx">Assertion</span><span class="p">(</span><span class="nx">obj</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">have</span><span class="p">.</span><span class="nx">deep</span><span class="p">.</span><span class="nx">property</span><span class="p">(</span><span class="dl">'</span><span class="s1">_attrs.age</span><span class="dl">'</span><span class="p">).</span><span class="nx">a</span><span class="p">(</span><span class="dl">'</span><span class="s1">number</span><span class="dl">'</span><span class="p">);</span>

      <span class="c1">// now we compare</span>
      <span class="kd">const</span> <span class="nx">age</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">age</span><span class="dl">'</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">assert</span><span class="p">(</span>
          <span class="nx">age</span> <span class="o">&gt;</span> <span class="nx">n</span>
        <span class="p">,</span> <span class="dl">"</span><span class="s2">expected #{this} to have an age above #{exp} but got #{act}</span><span class="dl">"</span>
        <span class="p">,</span> <span class="dl">"</span><span class="s2">expected #{this} to not have an age above #{exp} but got #{act}</span><span class="dl">"</span>
        <span class="p">,</span> <span class="nx">n</span>
        <span class="p">,</span> <span class="nx">age</span>
      <span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">_super</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">});</span>
</code></pre></div></div>

<p><a href="../../api/plugins/index.html#method_overwritemethod" class="clean-button">View overwriteMethod API</a></p>

<p>This covers both positive and negative scenarios. No need to transfer flags in this
case as <code class="language-js highlighter-rouge"><span class="k">this</span><span class="p">.</span><span class="nx">assert</span></code> handles that automatically. The same pattern can also be used
for <code class="language-js highlighter-rouge"><span class="nx">below</span></code> and <code class="language-js highlighter-rouge"><span class="nx">within</span></code>.</p>

        </div>
    </div>
</div>

<script src="../../js/guide.js"></script>

      </section>
    </div>

    <footer>
    <section id="footer">
        <div class="branding">
            <h3 class="fancy">
                <a href="https://www.chaijs.com/">Chai Assertion Library</a>
            </h3>
        </div>
        <div class="list">
            <ul>
                <li><a href="../installation/index.html">Installation</a></li>
                <li><a href="../styles/index.html">Interface Styles</a></li>
                <li><a href="../plugins/index.html">Developing Plugins</a></li>
            </ul>
        </div>
        <div class="list">
            <ul>
                <li><a href="../../api/bdd/index.html">Expect / Should API</a></li>
                <li><a href="../../api/assert/index.html">Assert API</a></li>
                <li><a href="../../api/plugins/index.html">Plugin Utility API</a></li>
            </ul>
        </div>
        <div class="list">
            <ul>
                <li><a href="../resources/index.html">Getting Help</a></li>
                <li><a href="../../api/test/index.html">Test Suite</a></li>
                <li><a href="https://www.chaijs.com/releases" target="_blank">Releases</a></li>
            </ul>
        </div>
        <div class="list">
            <ul>
                <li><a href="https://github.com/chaijs/chai/issues" target="_blank">Issues</a></li>
                <li><a href="https://groups.google.com/group/chaijs" target="_blank">Google Group</a></li>
                <li><a href="https://github.com/chaijs/chai/actions" target="_blank">Build Status</a></li>
            </ul>
        </div>
    </section>
</footer>


  




</body><!-- Mirrored from www.chaijs.com/guide/helpers/ by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 15 Apr 2025 08:02:15 GMT --></html>