<html><!-- Mirrored from www.chaijs.com/guide/plugins/ by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 15 Apr 2025 08:02:14 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Core Plugin Concepts</title>
    <meta name="description" content="Core Plugin Concepts">

    <link rel="icon" type="image/x-icon" href="../../img/favicon.ico">
    <link rel="canonical" href="index.html">

    <script type="text/javascript" async="" src="http://www.google-analytics.com/ga.js"></script><script src="../../../ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="../../js/jquery-mousewheel.js"></script>
    <script src="../../js/antiscroll.js"></script>
    <script src="../../js/main.js"></script>
    <script src="../../chai.js"></script>

    <link rel="stylesheet" ,="" href="../../css/antiscroll.css" type="text/css" media="all">
    <link rel="stylesheet" ,="" href="../../css/main.css" type="text/css" media="all">
    <script type="text/javascript">
        var mpq = [];
        mpq.push(["init", "d5e84615dbd02dbc359b0f76d0ed7cf5"]);
        (function(){var b,a,e,d,c;b=document.createElement("script");b.type="text/javascript";
        b.async=true;b.src=(document.location.protocol==="https:"?"https:":"http:")+
        ""exit/site_media/js/api/mixpanel.js";a=document.getElementsByTagName("script")[0];
        a.parentNode.insertBefore(b,a);e=function(f){return function(){mpq.push(
        [f].concat(Array.prototype.slice.call(arguments,0)))}};d=["init","track","track_links",
        "track_forms","register","register_once","identify","name_tag","set_config"];for(c=0;c<
        d.length;c++){mpq[d[c]]=e(d[c])}})();
    </script>
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-26183904-6']);
        _gaq.push(['_trackPageview']);
        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>
</head>


  <body class="guide">

    <nav id="primary">
    <div class="nav-wrap">
        <div class="logo">
            <h1><a href="https://www.chaijs.com/">Chai Assertion Library</a></h1>
        </div>
        <div class="navlist">
            <ul>
                <li><a href="../index.html">Guide</a></li>
                <li><a href="../../api/index.html">API</a></li>
                <li><a href="https://www.chaijs.com/plugins">Plugins</a></li>
            </ul>
        </div>
    </div>
</nav>


    

    <div class="content">
      <section id="content">
        <nav id="guide" class="sidebar sticky">

    
    
      
      
      
      
      <div id="getting-started-guide" class="item primary">
          
            <span class="star"></span>
          
          <a href="../index.html" class="title">Getting Started Guide</a>
      </div>
      
      
        <div class="line"></div>
      
    
      
      
      
      
      <div id="installation" class="item primary">
          
            <span class="expand">+</span>
            <span class="collapse">-</span>
          
          <a href="../installation/index.html" class="title">Installation</a>
      </div>
      
      <div id="installation" class="subitems">
          
          
          <a href="../installation/index.html#nodejs" class="item secondary group-installation">Node.js</a>
          
          
          <a href="../installation/index.html#browser" class="item secondary group-installation">Browser</a>
          
          
          <a href="../installation/index.html#other-platforms" class="item secondary group-installation">Other Platforms</a>
          
      </div>
      
      
    
      
      
      
      
      <div id="assertion-styles" class="item primary">
          
            <span class="expand">+</span>
            <span class="collapse">-</span>
          
          <a href="../styles/index.html" class="title">Assertion Styles</a>
      </div>
      
      <div id="assertion-styles" class="subitems">
          
          
          <a href="../styles/index.html#assert" class="item secondary group-assertion-styles">Assert</a>
          
          
          <a href="../styles/index.html#expect" class="item secondary group-assertion-styles">Expect</a>
          
          
          <a href="../styles/index.html#should" class="item secondary group-assertion-styles">Should</a>
          
          
          <a href="../styles/index.html#differences" class="item secondary group-assertion-styles">Differences</a>
          
          
          <a href="../styles/index.html#should-extras" class="item secondary group-assertion-styles">Should Extras</a>
          
          
          <a href="../styles/index.html#configuration" class="item secondary group-assertion-styles">Configuration</a>
          
      </div>
      
      
    
      
      
      
      
      <div id="using-chai-with-esm-and-plugins" class="item primary">
          
            <span class="expand">+</span>
            <span class="collapse">-</span>
          
          <a href="../using-chai-with-esm-and-plugins/index.html" class="title">Using Chai with ESM and Plugins</a>
      </div>
      
      <div id="using-chai-with-esm-and-plugins" class="subitems">
          
          
          <a href="../using-chai-with-esm-and-plugins/index.html#importing-chai" class="item secondary group-using-chai-with-esm-and-plugins">Importing Chai</a>
          
          
          <a href="../using-chai-with-esm-and-plugins/index.html#using-plugins" class="item secondary group-using-chai-with-esm-and-plugins">Using Plugins</a>
          
          
          <a href="../using-chai-with-esm-and-plugins/index.html#exposing-globals-in-plugins" class="item secondary group-using-chai-with-esm-and-plugins">Exposing Globals in Plugins</a>
          
      </div>
      
      
    
      
      
      
      
      <div id="core-plugin-concepts" class="item primary active expanded">
          
            <span class="expand">+</span>
            <span class="collapse">-</span>
          
          <a href="index.html" class="title">Core Plugin Concepts</a>
      </div>
      
      <div id="core-plugin-concepts" class="subitems">
          
          
          <a href="index.html#accessing-utilities" class="item secondary group-core-plugin-concepts expanded">Accessing Utilities</a>
          
          
          <a href="index.html#using-flags" class="item secondary group-core-plugin-concepts expanded">Using Flags</a>
          
          
          <a href="index.html#composing-an-assertion" class="item secondary group-core-plugin-concepts expanded">Composing an Assertion</a>
          
      </div>
      
      
    
      
      
      
      
      <div id="building-a-helper" class="item primary">
          
            <span class="expand">+</span>
            <span class="collapse">-</span>
          
          <a href="../helpers/index.html" class="title">Building a Helper</a>
      </div>
      
      <div id="building-a-helper" class="subitems">
          
          
          <a href="../helpers/index.html#adding-language-chains" class="item secondary group-building-a-helper">Adding Language Chains</a>
          
          
          <a href="../helpers/index.html#adding-properties" class="item secondary group-building-a-helper">Adding Properties</a>
          
          
          <a href="../helpers/index.html#adding-methods" class="item secondary group-building-a-helper">Adding Methods</a>
          
          
          <a href="../helpers/index.html#methods-as-properties" class="item secondary group-building-a-helper">Methods as Properties</a>
          
          
          <a href="../helpers/index.html#overwriting-language-chains" class="item secondary group-building-a-helper">Overwriting Language Chains</a>
          
          
          <a href="../helpers/index.html#overwriting-properties" class="item secondary group-building-a-helper">Overwriting Properties</a>
          
          
          <a href="../helpers/index.html#overwriting-methods" class="item secondary group-building-a-helper">Overwriting Methods</a>
          
      </div>
      
      
    
      
      
      
      
      <div id="resources" class="item primary">
          
            <span class="expand">+</span>
            <span class="collapse">-</span>
          
          <a href="../resources/index.html" class="title">Resources</a>
      </div>
      
      <div id="resources" class="subitems">
          
          
          <a href="../resources/index.html#getting-help" class="item secondary group-resources">Getting Help</a>
          
          
          <a href="../resources/index.html#contributing" class="item secondary group-resources">Contributing</a>
          
      </div>
      
      
    
</nav>
<div class="documentation">
    <div class="wrap">
        <div class="rendered">
            <h1 id="core-plugin-concepts">Core Plugin Concepts</h1>

<p>Plugins are for more than just writing vendor integrations. As a tester, one can write
a plugin to validate input data, assert schema validation on an object, or ensure proper behavior
on a DOM element. The API is flexible enough that any synchronous tasks can easily be encapsulated
within a single assertion and reused throughout your tests.</p>

<p>This tutorial will show you how to access Chai’s plugin API, use flags to transfer data through
the language chain, and write your first assertion (and thorough error messages). Once you have
finished here, <a href="../helpers/index.html">Building a Helper</a> will show you how to compose properties and
methods for use on the Chai language chain.</p>

<a class="dashAnchor" name="//apple_ref/Section/Accessing%20Utilities"></a><h2 id="accessing-utilities">Accessing Utilities</h2>

<p>Chai comes with a number of utilities to assist in the construction of assertions,
but it does not provide these directly on the <code class="language-js highlighter-rouge"><span class="nx">chai</span></code> export. These can be accessed
by using the <code class="language-js highlighter-rouge"><span class="nx">use</span></code> method of the chai export, which accepts a single function as
an argument.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">chai</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">_chai</span><span class="p">,</span> <span class="nx">utils</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">});</span>
</code></pre></div></div>

<p>The function which will be used gets passed two parameters to its scope. The first
is the <code class="language-js highlighter-rouge"><span class="nx">chai</span></code> export, the second is an object containing a number of utility
methods (we’ll get to those in a minute).</p>

<p>The <code class="language-js highlighter-rouge"><span class="nx">chai</span></code> export is included so that you can build helpers that can be used
in multiple test files, or package your helpers as a plugin to share with the
community. A more appropriate pattern for creating helpers is as follows…</p>

<p>For our helper file: <code class="language-js highlighter-rouge"><span class="nx">test</span><span class="o">/</span><span class="nx">helpers</span><span class="o">/</span><span class="nx">model</span><span class="p">.</span><span class="nx">js</span></code></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">function</span> <span class="nx">chaiModel</span><span class="p">(</span><span class="nx">chai</span><span class="p">,</span> <span class="nx">utils</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">Assertion</span> <span class="o">=</span> <span class="nx">chai</span><span class="p">.</span><span class="nx">Assertion</span><span class="p">;</span>

  <span class="c1">// your helpers here</span>
<span class="p">};</span>
</code></pre></div></div>

<p>And, for our actual test: <code class="language-js highlighter-rouge"><span class="nx">test</span><span class="o">/</span><span class="nx">person</span><span class="p">.</span><span class="nx">js</span></code></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">chai</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">chai</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">chaiModel</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./helpers/model.js</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">expect</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">chai</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">chai</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">chaiModel</span><span class="p">);</span>
</code></pre></div></div>

<p>For the rest of this document, we will assume this structure…</p>

<ul>
  <li>helper in external file</li>
  <li><code class="language-js highlighter-rouge"><span class="nx">chai</span><span class="p">.</span><span class="nx">Assertion</span></code> assigned to the <code class="language-js highlighter-rouge"><span class="nx">Assertion</span></code> variable</li>
  <li>all of our helpers will be inside exported function, located where indicated</li>
</ul>

<p>The <code class="language-js highlighter-rouge"><span class="nx">Assertion</span></code> variable is now a constructor for an assertion chain;
<code class="language-js highlighter-rouge"><span class="k">new</span> <span class="nx">Assertion</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span></code> is now equivalent to <code class="language-js highlighter-rouge"><span class="nx">expect</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span></code>.</p>

<a class="dashAnchor" name="//apple_ref/Section/Using%20Flags"></a><h2 id="using-flags">Using Flags</h2>

<p>The upper-most core concept of how assertions work internally is the concept of flags.
Each assertion has a set of mostly arbitrary flags - key:value pairs - associated with it.
Chai uses a small number of these internally, but the store is also available for developers
to expand on.</p>

<a class="dashAnchor" name="//apple_ref/Section/flag%20usage"></a><h3 id="flag-usage">flag usage</h3>

<p>The flag utility is exposed as <code class="language-js highlighter-rouge"><span class="nx">utils</span><span class="p">.</span><span class="nx">flag</span></code> from within our <code class="language-js highlighter-rouge"><span class="nx">use</span></code> function. It can function
as either a getter or a setter, depending on the number of arguments passed to it.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">myAssert</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Assertion</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span>
<span class="nx">utils</span><span class="p">.</span><span class="nx">flag</span><span class="p">(</span><span class="nx">myAssert</span><span class="p">,</span> <span class="dl">'</span><span class="s1">owner</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">me</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// sets key `owner` to `me`</span>
<span class="kd">const</span> <span class="nx">owner</span> <span class="o">=</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">flag</span><span class="p">(</span><span class="nx">myAssert</span><span class="p">,</span> <span class="dl">'</span><span class="s1">owner</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// get key `owner', returns value</span>
</code></pre></div></div>

<a class="dashAnchor" name="//apple_ref/Section/object%20flag"></a><h3 id="object-flag">object flag</h3>

<p>The most important of Chai’s reserved flags is the <code class="language-js highlighter-rouge"><span class="nx">object</span></code> flag. This is the subject
of an assertion.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">myAssert</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Assertion</span><span class="p">(</span><span class="dl">'</span><span class="s1">Arthur Dent</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nx">flag</span><span class="p">(</span><span class="nx">myAssert</span><span class="p">,</span> <span class="dl">'</span><span class="s1">object</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// obj === 'Arthur Dent';</span>
</code></pre></div></div>

<p>This flag is so often used that a shortcut was provided as the <code class="language-js highlighter-rouge"><span class="nx">_obj</span></code> property of a
constructed assertion.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nx">myAssert</span><span class="p">.</span><span class="nx">_obj</span><span class="p">;</span> <span class="c1">// obj === `Arthur Dent`</span>
</code></pre></div></div>

<p>The following flags are used by Chai’s core assertions. Side effects may occur should you
interfere with these.</p>

<ul>
  <li><code class="language-js highlighter-rouge"><span class="nx">object</span></code>: (see above)</li>
  <li><code class="language-js highlighter-rouge"><span class="nx">ssfi</span></code>: start stack function - used to prevent callback stacks from being shown in
errors.</li>
  <li><code class="language-js highlighter-rouge"><span class="nx">message</span></code>: additional information to include with an error when using <code class="language-js highlighter-rouge"><span class="nx">assert</span></code> interface.</li>
  <li><code class="language-js highlighter-rouge"><span class="nx">negate</span></code>: set when <code class="language-js highlighter-rouge"><span class="p">.</span><span class="nx">not</span></code> is included in the chain.</li>
  <li><code class="language-js highlighter-rouge"><span class="nx">deep</span></code>: set when <code class="language-js highlighter-rouge"><span class="p">.</span><span class="nx">deep</span></code> is included in the chain. used by <code class="language-js highlighter-rouge"><span class="nx">equal</span></code> and <code class="language-js highlighter-rouge"><span class="nx">property</span></code></li>
  <li><code class="language-js highlighter-rouge"><span class="nx">contains</span></code>: set when <code class="language-js highlighter-rouge"><span class="nx">include</span></code> or <code class="language-js highlighter-rouge"><span class="nx">contain</span></code> is used as a property.
changes the behavior of <code class="language-js highlighter-rouge"><span class="nx">keys</span></code>.</li>
  <li><code class="language-js highlighter-rouge"><span class="nx">lengthOf</span></code>: set when <code class="language-js highlighter-rouge"><span class="nx">length</span></code> is used as a property. changes the behavior of
<code class="language-js highlighter-rouge"><span class="nx">above</span></code>, <code class="language-js highlighter-rouge"><span class="nx">below</span></code>, and <code class="language-js highlighter-rouge"><span class="nx">within</span></code>.</li>
</ul>

<a class="dashAnchor" name="//apple_ref/Section/Composing%20an%20Assertion"></a><h2 id="composing-an-assertion">Composing an Assertion</h2>

<p>Before we begin adding methods and properties to the language chain, we should
first examine how to invoke an assertion, and the expected behavior should it fail.</p>

<p>For this, each constructed <code class="language-js highlighter-rouge"><span class="nx">Assertion</span></code> has a method called simply <code class="language-js highlighter-rouge"><span class="nx">assert</span></code>. It accepts
many parameters and its behavior can change depending on whether an assertion was
negated or not.</p>

<a class="dashAnchor" name="//apple_ref/Section/Basic%20Assertion"></a><h3 id="basic-assertion">Basic Assertion</h3>

<p>To begin, we will construct Arthur again, then we can assert that he is who he says he is.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">arthur</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Assertion</span><span class="p">(</span><span class="dl">'</span><span class="s1">Arthur Dent</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">arthur</span><span class="p">.</span><span class="nx">assert</span><span class="p">(</span>
    <span class="nx">arthur</span><span class="p">.</span><span class="nx">_obj</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">Arthur Dent</span><span class="dl">'</span>
  <span class="p">,</span> <span class="dl">"</span><span class="s2">expected #{this} to be 'Arthur Dent'</span><span class="dl">"</span>
  <span class="p">,</span> <span class="dl">"</span><span class="s2">expected #{this} to not be 'Arthur Dent'</span><span class="dl">"</span>
<span class="p">);</span>
</code></pre></div></div>

<p>Chai will check the first argument; if it is <code class="language-js highlighter-rouge"><span class="kc">true</span></code> then the assertion passed, but if it is <code class="language-js highlighter-rouge"><span class="kc">false</span></code>
the assertion failed and the first error message will be thrown as part of a <code class="language-js highlighter-rouge"><span class="nx">chai</span><span class="p">.</span><span class="nx">AssertionError</span></code>.
Conversely, if the language chain was negated, it will consider <code class="language-js highlighter-rouge"><span class="kc">false</span></code> a pass and <code class="language-js highlighter-rouge"><span class="kc">true</span></code> a failure.
The second error message will be included in the thrown error instead.</p>

<p>In all, the <code class="language-js highlighter-rouge"><span class="nx">assert</span></code> method accepts six arguments:</p>

<ol>
  <li>a boolean (result of a truth test)</li>
  <li>a string error message to be used if the first argument is <code class="language-js highlighter-rouge"><span class="kc">false</span></code></li>
  <li>a string error message to be used if the assertion is negated and the first argument is <code class="language-js highlighter-rouge"><span class="kc">true</span></code></li>
  <li>(optional) the expected value</li>
  <li>(optional) the actual value, which will default to <code class="language-js highlighter-rouge"><span class="nx">_obj</span></code></li>
  <li>(optional) a boolean which indicates whether to display a diff in addition to the message if the first argument is <code class="language-js highlighter-rouge"><span class="kc">false</span></code></li>
</ol>

<a class="dashAnchor" name="//apple_ref/Section/Composing%20Error%20Messages"></a><h3 id="composing-error-messages">Composing Error Messages</h3>

<p>As you can see from the above example, Chai can accept template tags to dynamically compose
the error message. When used, these template tags will be replaced with a stringified replacement
of the object in question. There are three template tags available.</p>

<ul>
  <li><code class="language-js highlighter-rouge"><span class="err">#</span><span class="p">{</span><span class="k">this</span><span class="p">}</span></code>: the <code class="language-js highlighter-rouge"><span class="nx">_obj</span></code> of the assertion</li>
  <li><code class="language-js highlighter-rouge"><span class="err">#</span><span class="p">{</span><span class="nx">exp</span><span class="p">}</span></code>: the expected value, if it was provided in <code class="language-js highlighter-rouge"><span class="nx">assert</span></code></li>
  <li><code class="language-js highlighter-rouge"><span class="err">#</span><span class="p">{</span><span class="nx">act</span><span class="p">}</span></code>: the actual value, defaults to <code class="language-js highlighter-rouge"><span class="nx">_obj</span></code> but can be overwritten by value provided in <code class="language-js highlighter-rouge"><span class="nx">assert</span></code></li>
</ul>

        </div>
    </div>
</div>

<script src="../../js/guide.js"></script>

      </section>
    </div>

    <footer>
    <section id="footer">
        <div class="branding">
            <h3 class="fancy">
                <a href="https://www.chaijs.com/">Chai Assertion Library</a>
            </h3>
        </div>
        <div class="list">
            <ul>
                <li><a href="../installation/index.html">Installation</a></li>
                <li><a href="../styles/index.html">Interface Styles</a></li>
                <li><a href="index.html">Developing Plugins</a></li>
            </ul>
        </div>
        <div class="list">
            <ul>
                <li><a href="../../api/bdd/index.html">Expect / Should API</a></li>
                <li><a href="../../api/assert/index.html">Assert API</a></li>
                <li><a href="../../api/plugins/index.html">Plugin Utility API</a></li>
            </ul>
        </div>
        <div class="list">
            <ul>
                <li><a href="../resources/index.html">Getting Help</a></li>
                <li><a href="../../api/test/index.html">Test Suite</a></li>
                <li><a href="https://www.chaijs.com/releases" target="_blank">Releases</a></li>
            </ul>
        </div>
        <div class="list">
            <ul>
                <li><a href="https://github.com/chaijs/chai/issues" target="_blank">Issues</a></li>
                <li><a href="https://groups.google.com/group/chaijs" target="_blank">Google Group</a></li>
                <li><a href="https://github.com/chaijs/chai/actions" target="_blank">Build Status</a></li>
            </ul>
        </div>
    </section>
</footer>


  




</body><!-- Mirrored from www.chaijs.com/guide/plugins/ by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 15 Apr 2025 08:02:15 GMT --></html>